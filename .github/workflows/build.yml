name: Build Windows Release

on:
    push:
        branches: ["main", "master"]

jobs:
    build-windows:
        runs-on: windows-latest

        steps:
            - uses: actions/checkout@v4

            - name: Install Rust
              uses: dtolnay/rust-toolchain@stable

            - name: Install libheif via vcpkg
              run: |
                  vcpkg install libheif:x64-windows-static

            - name: Build Release
              run: cargo build --release
              env:
                  # Tell Rust to look for the built-in vcpkg
                  VCPKG_ROOT: C:\smoketest\vcpkg
                  # Force static linking so you don't need to hunt for .dll files
                  LIBHEIF_STATIC: 1

            - name: Upload Executable
              uses: actions/upload-artifact@v4
              with:
                  name: ImgViewer-Windows
                  path: target/release/ImgViewer.exe
