name: Build Windows Release

on:
    push:
        branches: ["main", "master"]

jobs:
    build-windows:
        runs-on: windows-latest

        steps:
            - uses: actions/checkout@v4

            - name: Install Rust
              uses: dtolnay/rust-toolchain@stable

            - name: Setup vcpkg
              uses: lukka/run-vcpkg@v11
              with:
                  vcpkgGitCommitId: "df3697e8840a6e3090623a6358c8a14b10b05b63" # Update to a recent commit if needed

            - name: Install libheif via vcpkg
              run: |
                  vcpkg install libheif:x64-windows

            - name: Build Release
              run: cargo build --release
              env:
                  # These env vars tell the 'libheif-sys' crate to use vcpkg to find the library
                  VCPKG_ROOT: ${{ github.workspace }}/vcpkg
                  VCPKGRS_DYNAMIC: 1

            - name: Upload Executable
              uses: actions/upload-artifact@v4
              with:
                  name: ImgViewer-Windows
                  path: target/release/ImgViewer.exe
